---
sudo: required
services:
  - docker

env:
  # - DOCKER_COMPOSE_VERSION=1.4.2
  - ANSIBLE_VERSION=latest

branches:
  only:
    - master

# before_install:
#   - sudo apt-get update -qq
#   - sudo rm /usr/local/bin/docker-compose
#   - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
#   - chmod +x docker-compose
#   - sudo mv docker-compose /usr/local/bin

install:
  # Install Ansible.
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible; else pip install ansible==$ANSIBLE_VERSION; fi
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible-lint; fi

script:
  - docker-compose build
  # Check the role/playbook's syntax.
  - ansible-playbook -i tests/inventory tests/test.yml --syntax-check
  - ansible-playbook -i github-deployment/inventory.yml --vault-id github-deployment/roles/setup/vars/ansible-vault-pw github-deployment/site.yml -vvvv

# # before_deploy:
# #   - docker login -u ${DOCKER_USERNAME} -p ${DOCKER_PASSWORD}

# # deploy:
# #   provider: script
# #   script: docker-compose push ${DOCKER_USERNAME}/${DOCKERHUB_IMAGE}
# #   on:
# #     branch: master

# after_success:
#   - echo Deploying to AWS EC2 instance...
#   # - bash github-deployment/start_deployment.sh
